<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AdsPower Poster</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: #f8fafc;
            color: #0f172a;
        }

        .card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
        }

        .form-control,
        .form-control:focus {
            background: #ffffff;
            color: #0f172a;
            border-color: #cbd5e1;
        }

        .muted {
            color: #64748b;
        }

        .brand-gradient {
            background: linear-gradient(135deg, #60a5fa 0%, #34d399 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-gradient {
            border: 0;
            color: #fff;
            background: linear-gradient(90deg, #06b6d4, #3b82f6, #8b5cf6);
            box-shadow: 0 10px 20px rgba(59, 130, 246, .25);
            transition: transform .06s ease, filter .2s ease;
        }

        .btn-gradient:hover {
            filter: brightness(1.05);
        }

        .btn-gradient:active {
            transform: translateY(1px);
        }

        #contactBtn:hover {
            background-color: #0bbbe0 !important;
            color: white !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(13, 202, 240, 0.3);
        }

        .log-style {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }
        .title-log{
            background: #0b1020;
            color: white;
            padding: 8px 12px;
            margin-bottom: -8px;
            border-radius: 12px 12px 0px 0px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .log-floating {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(90deg, #06b6d4, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .log-floating:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0,0,0,0.4);
        }
        
        .log-hidden {
            display: none !important;
        }

        /* Splash Screen Styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        .splash-content {
            text-align: center;
            color: #334155;
        }

        .splash-logo {
            max-width: 200px;
            max-height: 200px;
            width: auto;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            animation: logoFloat 2s ease-in-out infinite alternate;
        }

        .splash-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(51, 65, 85, 0.2);
            border-top: 4px solid #334155;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .splash-text {
            font-size: 18px;
            font-weight: 500;
            margin: 0;
            opacity: 0.8;
            color: #64748b;
        }

        @keyframes logoFloat {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-10px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .splash-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <img src="https://blogger.googleusercontent.com/img/a/AVvXsEhO_SYr_0ToVSpQY_sqrQj7valPMeLGGb8q2uh57ET7ljqT0cjeE9u9fvy3Nfa-bK5rERnUJevg8523LBQViIlmyBlCDMIBWxj3wUaHamm9q4-07kYzTjDjxp2McILUqWWGpdDwDMRnmnjyuv78xHuSwnHjUiVEcUSKVpzFXO4FmyfyGNeRID-NR0wY25k" alt="Logo" class="splash-logo">
            <div class="splash-loading">
                <div class="spinner"></div>
                <p class="splash-text">Đang tải...</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container-fluid min-vh-100 d-flex flex-column p-0" style="display: none;">
        <nav class="navbar navbar-light bg-white border-bottom px-3 py-2">
            <span class="navbar-brand mb-0 h4 fw-bold brand-gradient">T2 TOOL</span>
            <span class="muted small">FB: mt.meow.meow</span>
        </nav>

        <div class="row g-0 flex-fill">
            <div class="col-12 col-lg-6 p-4 p-lg-5">
                <div class="card shadow-sm p-4 p-lg-5">
                    <div class="row g-3">
                        <div class="col-12 col-md-6">
                            <label for="userId" class="form-label">ADSPOWER_USER_ID</label>
                            <input type="text" class="form-control" id="userId" placeholder="Nhập user id..."
                                value="k1571o14">
                        </div>
                        <div class="col-12 col-md-6">
                            <label for="apiKey" class="form-label">GEMINI_API_KEY</label>
                            <input type="text" class="form-control" id="apiKey" placeholder="Nhập API key..."
                                value="AIzaSyBrxRH0j1gM0sWCiwEhf-_VPJ5eSyRvDrs">
                        </div>
                        <div class="col-12">
                            <label for="context" class="form-label">Bối cảnh (tuỳ chọn)</label>
                            <textarea class="form-control" id="context" rows="8"
                                placeholder="Nhập bối cảnh, ghi chú...">Bài viết về vẻ đẹp của người phụ nữ</textarea>
                        </div>
                        <div class="col-12 col-md-6">
                            <label for="model" class="form-label">Model</label>
                            <select id="model" class="form-select">
                                <option value="gemini-2.5-flash" selected>gemini-2.5-flash</option>
                                <option value="gemini-2.5-pro">gemini-2.5-pro</option>
                                <option value="gemini-2.5-flash-lite">gemini-2.5-flash-lite</option>
                            </select>
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label">Số ảnh mỗi bài (min/max)</label>
                            <div class="row g-2">
                                <div class="col-6">
                                    <input type="number" min="1" max="20" value="1" id="imagesMin" class="form-control"
                                        placeholder="min">
                                </div>
                                <div class="col-6">
                                    <input type="number" min="1" max="20" value="3" id="imagesMax" class="form-control"
                                        placeholder="max">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label">Delay giữa các bài (giây, min/max)</label>
                            <div class="row g-2">
                                <div class="col-6">
                                    <input type="number" min="0" max="3600" value="2" id="delayMin" class="form-control"
                                        placeholder="min">
                                </div>
                                <div class="col-6">
                                    <input type="number" min="0" max="3600" value="5" id="delayMax" class="form-control"
                                        placeholder="max">
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" value="1" id="scheduleToggle" checked>
                                <label class="form-check-label" for="scheduleToggle">
                                    Đăng theo lịch
                                </label>
                            </div>
                        </div>
                        <div class="col-12" id="scheduleSection">
                            <div class="row g-3 mt-1">
                                <div class="col-12 col-lg-6">
                                    <label class="form-label">Từ ngày</label>
                                    <input type="date" class="form-control" id="fromDate">
                                </div>
                                <div class="col-12 col-lg-6">
                                    <label class="form-label">Đến ngày</label>
                                    <input type="date" class="form-control" id="toDate">
                                </div>
                                <div class="col-12 col-lg-6">
                                    <label class="form-label">Từ giờ</label>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <select id="fromHour" class="form-select"></select>
                                        </div>
                                        <div class="col-6">
                                            <select id="fromMinute" class="form-select"></select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-6">
                                    <label class="form-label">Đến giờ</label>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <select id="toHour" class="form-select"></select>
                                        </div>
                                        <div class="col-6">
                                            <select id="toMinute" class="form-select"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="row g-2">
                                <div class="col-12 col-md-6">
                                    <button id="runBtn" class="btn btn-lg btn-gradient w-100 py-3">Đăng theo
                                        lịch</button>
                                </div>
                                <div class="col-12 col-md-6">
                                    <button id="stopBtn" class="btn btn-lg btn-outline-danger w-100 py-3"
                                        >Dừng</button>
                                </div>
                            </div>
                            <div id="status" class="mt-3 small muted"></div>
                        </div>
                    </div>
                </div>
                <div class="text-start mt-3 px-1">
                    <span class="small muted">Ảnh được lấy từ thư mục <code>temp/images_random</code></span>
                </div>
            </div>

            <div class="col-12 col-lg-6 bg-white p-4 p-lg-5 border-start d-flex flex-column">
                <div class="row g-4 align-items-start">
                    <div class="col-12 col-md-6">
                        <h4 class="fw-semibold mb-3">Lịch đăng</h4>
                        <ul id="scheduleList" class="list-group small" style="height:420px; overflow:auto;"></ul>
                        <div id="scheduleHint" class="small muted mt-2"></div>
                    </div>
                    <div class="col-12 col-md-6">
                        <h4 class="fw-semibold mb-3">Chức năng (auto)</h4>
                        <div class="row g-2">
                            <div class="col-12 col-md-6">
                                <button id="shareBtn" class="btn btn-primary w-100">Auto share chéo</button>
                            </div>
                            <div class="col-12 col-md-6">
                                <button id="likeBtn" class="btn btn-secondary w-100">Like chéo</button>
                            </div>
                            <div class="col-12 col-md-6">
                                <button id="clearLogBtn" class="btn btn-outline-secondary w-100">Clear log</button>
                            </div>
                            <div class="col-12 col-md-6">
                                <button id="contactBtn" class="btn btn-info w-100"
                                    style="font-weight: 500; transition: all 0.2s ease;">
                                    <i class="bi bi-facebook me-1"></i>Liên hệ
                                </button>
                            </div>
                        </div>
                    </div>
                     <div class="mt-auto pt-3 log-style log-hidden" id="logSection">
                         <div class="title-log">
                             <span class="fw-semibold">Log</span>
                             <i class="bi bi-x-circle-fill text-danger" id="closeLogBtn" style="cursor: pointer; font-size: 18px;"></i>
                         </div>
                         <pre id="logBox" class="p-3 rounded"
                             style="background:#0b1020;color:#10b981;height:220px;overflow:auto;font-family:ui-monospace, SFMono-Regular, Menlo, monospace;border:1px solid #1f2937;"></pre>
                     </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Splash Screen Management
        function initSplashScreen() {
            const splashScreen = document.getElementById('splashScreen');
            const mainApp = document.getElementById('mainApp');
            
            // Show splash screen for 3 seconds
            setTimeout(() => {
                splashScreen.classList.add('fade-out');
                
                // After fade animation completes, show main app
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                    mainApp.style.display = 'flex';
                }, 500); // Match CSS transition duration
            }, 3000); // 3 seconds splash duration
        }

        // Initialize splash screen when page loads
        document.addEventListener('DOMContentLoaded', initSplashScreen);

        const userIdInput = document.getElementById('userId');
        const runBtn = document.getElementById('runBtn');
        const statusBox = document.getElementById('status');
        const stopBtn = document.getElementById('stopBtn');
        const shareBtn = document.getElementById('shareBtn');
        const likeBtn = document.getElementById('likeBtn');
        const clearLogBtn = document.getElementById('clearLogBtn');
        const contactBtn = document.getElementById('contactBtn');
        const logBox = document.getElementById('logBox');
        const logSection = document.getElementById('logSection');
        const closeLogBtn = document.getElementById('closeLogBtn');
        const contextInput = document.getElementById('context');
        const scheduleToggle = document.getElementById('scheduleToggle');
        const scheduleSection = document.getElementById('scheduleSection');
        const scheduleList = document.getElementById('scheduleList');
        const scheduleHint = document.getElementById('scheduleHint');
        const fromHour = document.getElementById('fromHour');
        const fromMinute = document.getElementById('fromMinute');
        const toHour = document.getElementById('toHour');
        const toMinute = document.getElementById('toMinute');

        function setStatus(text, isError = false) {
            statusBox.textContent = text || '';
            statusBox.style.color = isError ? '#fca5a5' : '#94a3b8';
        }

        function logLine(text) {
            if (!logBox) return;
            const now = new Date();
            const ts = now.toLocaleTimeString();
            logBox.textContent += `[${ts}] ${text}\n`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // Expose for Python to append logs via evaluate_js
        window.__appendLog = function (text) {
            try {
                if (typeof text !== 'string') {
                    text = String(text ?? '');
                }
                logLine(text);
            } catch (e) {
                // no-op
            }
        }

        if (clearLogBtn) {
            clearLogBtn.addEventListener('click', () => {
                logBox.textContent = 'Cleared!\n';
            });
        }

        runBtn.addEventListener('click', async () => {
            const userId = (userIdInput.value || '').trim();
            if (!userId) {
                setStatus('Vui lòng nhập ADSPOWER_USER_ID', true);
                return;
            }
            runBtn.disabled = true;
            setStatus('Đang chạy...');
            logLine('Run once started');
            try {
                const context = (contextInput.value || '').trim();
                const apiKey = (document.getElementById('apiKey').value || '').trim();
                const model = (document.getElementById('model').value || '').trim();
                // Build schedule array of [date, time] if toggle is on
                let schedule = [];
                if (scheduleToggle.checked) {
                    const fromDateEl = document.getElementById('fromDate');
                    const toDateEl = document.getElementById('toDate');
                    const fd = parseDateInput(fromDateEl);
                    const td = parseDateInput(toDateEl);
                    const fh = parseInt(fromHour.value || '0', 10);
                    const fm = parseInt(fromMinute.value || '0', 10);
                    const th = parseInt(toHour.value || '0', 10);
                    const tm = parseInt(toMinute.value || '0', 10);
                    if (fd && td) {
                        const start = new Date(fd.y, fd.m - 1, fd.d, fh, fm, 0, 0);
                        const end = new Date(td.y, td.m - 1, td.d, th, tm, 0, 0);
                        if (!isNaN(start.getTime()) && !isNaN(end.getTime()) && end >= start) {
                            const pad2 = (n) => n.toString().padStart(2, '0');
                            const cursor = new Date(start.getTime());
                            cursor.setMinutes(0, 0, 0);
                            if (start.getMinutes() > 0 || start.getSeconds() > 0 || start.getMilliseconds() > 0) {
                                cursor.setHours(cursor.getHours() + 1);
                            }
                            while (cursor.getTime() <= end.getTime()) {
                                const dateStr = `${parseInt(pad2(cursor.getMonth() + 1), 10)}/${parseInt(pad2(cursor.getDate()), 10)}/${cursor.getFullYear()}`;
                                const h24 = cursor.getHours();
                                const ampm = h24 >= 12 ? 'PM' : 'AM';
                                const h12 = h24 % 12 === 0 ? 12 : h24 % 12;
                                const timeStr = `${pad(h12)}:00 ${ampm}`;
                                schedule.push([dateStr, timeStr]);
                                cursor.setHours(cursor.getHours() + 1);
                            }
                            if (schedule.length === 0) {
                                const dateStr = `${parseInt(pad2(start.getMonth() + 1), 10)}/${parseInt(pad2(start.getDate()), 10)}/${start.getFullYear()}`;
                                const h24 = start.getHours();
                                const ampm = h24 >= 12 ? 'PM' : 'AM';
                                const h12 = h24 % 12 === 0 ? 12 : h24 % 12;
                                const timeStr = `${pad(h12)}:00 ${ampm}`;
                                schedule.push([dateStr, timeStr]);
                            }
                        }
                    }
                }
                // Build settings
                const imagesMin = Math.max(1, parseInt((document.getElementById('imagesMin').value || '1'), 10));
                const imagesMax = Math.max(imagesMin, parseInt((document.getElementById('imagesMax').value || String(imagesMin)), 10));
                const delayMin = Math.max(0, parseInt((document.getElementById('delayMin').value || '0'), 10));
                const delayMax = Math.max(delayMin, parseInt((document.getElementById('delayMax').value || String(delayMin)), 10));
                const settings = { imagesMin, imagesMax, delayMin, delayMax };

                const res = await window.pywebview.api.run_once(userId, context, apiKey, model, schedule, settings);
                if (res && res.success) {
                    setStatus('Hoàn tất.');
                    logLine('Run once completed');
                } else {
                    setStatus((res && res.error) || 'Có lỗi xảy ra.', true);
                    logLine('Run once failed');
                    runBtn.disabled = false; // Cho phép chạy lại nếu thất bại
                }
            } catch (e) {
                setStatus('Lỗi: ' + (e && e.message ? e.message : e), true);
                logLine('Run once error: ' + (e && e.message ? e.message : e));
                runBtn.disabled = false;
            }
        });

        // Stop button handler
        stopBtn.addEventListener('click', async () => {
            try {
                stopBtn.disabled = true;
                setStatus('Đang dừng...');
                logLine('Stop requested');
                const res = await window.pywebview.api.stop_run();
                setStatus(("Đã dừng", true))
                stopBtn.disabled = false;
                runBtn.disabled = false
            } catch (e) {
                setStatus('Lỗi dừng: ' + (e && e.message ? e.message : e), true);
            }
        });

        shareBtn.addEventListener('click', async () => {
            const userId = (userIdInput.value || '').trim();
            if (!userId) {
                setStatus('Vui lòng nhập ADSPOWER_USER_ID', true);
                return;
            }
            shareBtn.disabled = true;
            setStatus('Đang chạy share chéo...');
            logLine('Share chéo started');
            try {
                const res = await window.pywebview.api.share_cheo(userId);
                if (res && res.success) {
                    setStatus(res.message || 'Share chéo hoàn tất.');
                    logLine('Share chéo completed');
                } else {
                    setStatus((res && res.error) || 'Có lỗi xảy ra.', true);
                    logLine('Share chéo failed');
                }
            } catch (e) {
                setStatus('Lỗi: ' + (e && e.message ? e.message : e), true);
                logLine('Share chéo error: ' + (e && e.message ? e.message : e));
            } finally {
                shareBtn.disabled = false;
            }
        });

        likeBtn.addEventListener('click', async () => {
            const userId = (userIdInput.value || '').trim();
            if (!userId) {
                setStatus('Vui lòng nhập ADSPOWER_USER_ID', true);
                return;
            }
            likeBtn.disabled = true;
            setStatus('Đang chạy like chéo...');
            logLine('Like chéo started');
            try {
                const res = await window.pywebview.api.like_cheo(userId);
                if (res && res.success) {
                    setStatus(res.message || 'Like chéo hoàn tất.');
                    logLine('Like chéo completed');
                } else {
                    setStatus((res && res.error) || 'Có lỗi xảy ra.', true);
                    logLine('Like chéo failed');
                }
            } catch (e) {
                setStatus('Lỗi: ' + (e && e.message ? e.message : e), true);
                logLine('Like chéo error: ' + (e && e.message ? e.message : e));
            } finally {
                likeBtn.disabled = false;
            }
        });

        // Contact button handler
        if (contactBtn) {
            contactBtn.addEventListener('click', () => {
                window.open('https://www.facebook.com/mt.meow.meow/', '_blank');
            });
        }

        // Create initial floating button
        const createFloatingButton = () => {
            const floatingBtn = document.createElement('div');
            floatingBtn.className = 'log-floating';
            floatingBtn.innerHTML = '<i class="bi bi-terminal text-white" style="font-size: 24px;"></i>';
            floatingBtn.id = 'floatingLogBtn';
            
            // Add to body
            document.body.appendChild(floatingBtn);
            
            // Click handler for floating button
            floatingBtn.addEventListener('click', () => {
                // Show log section
                logSection.classList.remove('log-hidden');
                // Remove floating button
                floatingBtn.remove();
            });
        };

        // Close log handler - animate to floating button
        if (closeLogBtn) {
            closeLogBtn.addEventListener('click', () => {
                // Hide the log section
                logSection.classList.add('log-hidden');
                // Create floating button
                createFloatingButton();
            });
        }

        // Create initial floating button on page load
        createFloatingButton();

        // Populate time selects
        function pad(n) { return n.toString().padStart(2, '0'); }
        for (let h = 0; h < 24; h++) {
            const opt1 = document.createElement('option'); opt1.value = pad(h); opt1.textContent = pad(h); fromHour.appendChild(opt1);
            const opt2 = document.createElement('option'); opt2.value = pad(h); opt2.textContent = pad(h); toHour.appendChild(opt2);
        }
        for (let m = 0; m < 60; m += 5) {
            const opt1 = document.createElement('option'); opt1.value = pad(m); opt1.textContent = pad(m); fromMinute.appendChild(opt1);
            const opt2 = document.createElement('option'); opt2.value = pad(m); opt2.textContent = pad(m); toMinute.appendChild(opt2);
        }
        // Defaults: from tomorrow to tomorrow + 1 day, 08:00 to 20:00
        const now = new Date();
        const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
        const dayAfterTomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 2);
        const fmtDate = (d) => `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;
        document.getElementById('fromDate').value = fmtDate(tomorrow);
        document.getElementById('toDate').value = fmtDate(dayAfterTomorrow);
        fromHour.value = '08';
        fromMinute.value = '00';
        toHour.value = '20';
        toMinute.value = '00';

        // Toggle schedule section visibility
        function updateScheduleVisibility() {
            scheduleSection.style.display = scheduleToggle.checked ? '' : 'none';
        }
        scheduleToggle.addEventListener('change', updateScheduleVisibility);
        updateScheduleVisibility();

        function parseDateInput(el) {
            const v = (el.value || '').trim();
            if (!v) return null;
            // v format: YYYY-MM-DD
            const [y, m, d] = v.split('-').map(Number);
            if (!y || !m || !d) return null;
            return { y, m, d };
        }

        function buildSlots() {
            scheduleList.innerHTML = '';
            scheduleHint.textContent = '';

            if (!scheduleToggle.checked) {
                scheduleHint.textContent = 'Tắt lịch đăng.';
                return;
            }

            const fromDateEl = document.getElementById('fromDate');
            const toDateEl = document.getElementById('toDate');
            const fd = parseDateInput(fromDateEl);
            const td = parseDateInput(toDateEl);
            const fh = parseInt(fromHour.value || '0', 10);
            const fm = parseInt(fromMinute.value || '0', 10);
            const th = parseInt(toHour.value || '0', 10);
            const tm = parseInt(toMinute.value || '0', 10);

            if (!fd || !td) {
                scheduleHint.textContent = 'Chọn đủ ngày bắt đầu và kết thúc.';
                return;
            }

            const start = new Date(fd.y, fd.m - 1, fd.d, fh, fm, 0, 0);
            const end = new Date(td.y, td.m - 1, td.d, th, tm, 0, 0);
            if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                scheduleHint.textContent = 'Ngày/giờ không hợp lệ.';
                return;
            }
            if (end < start) {
                scheduleHint.textContent = 'Thời gian kết thúc phải sau thời gian bắt đầu.';
                return;
            }

            // Generate slots hourly including both ends (e.g., 6:00 to 9:00 => 6,7,8,9)
            const pad2 = (n) => n.toString().padStart(2, '0');
            const slots = [];
            const cursor = new Date(start.getTime());
            cursor.setMinutes(0, 0, 0);
            // If start has minutes > 0, start from next hour
            if (start.getMinutes() > 0 || start.getSeconds() > 0 || start.getMilliseconds() > 0) {
                cursor.setHours(cursor.getHours() + 1);
            }
            while (cursor.getTime() <= end.getTime()) {
                slots.push(`${pad2(cursor.getHours())}:00 ${pad2(cursor.getDate())}/${pad2(cursor.getMonth() + 1)}/${cursor.getFullYear()}`);
                cursor.setHours(cursor.getHours() + 1);
            }

            if (slots.length === 0) {
                // If within same hour and end >= start, still include the start's rounded hour
                slots.push(`${pad2(start.getHours())}:00 ${pad2(start.getDate())}/${pad2(start.getMonth() + 1)}/${start.getFullYear()}`);
            }

            for (const s of slots) {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex align-items-center py-2';
                li.textContent = s;
                scheduleList.appendChild(li);
            }
        }

        // Recompute slots on relevant changes
        ['change', 'input'].forEach(evt => {
            document.getElementById('fromDate').addEventListener(evt, buildSlots);
            document.getElementById('toDate').addEventListener(evt, buildSlots);
            fromHour.addEventListener(evt, buildSlots);
            fromMinute.addEventListener(evt, buildSlots);
            toHour.addEventListener(evt, buildSlots);
            toMinute.addEventListener(evt, buildSlots);
        });
        scheduleToggle.addEventListener('change', buildSlots);
        // Initial render once defaults are set above
        buildSlots();
    </script>
</body>

</html>